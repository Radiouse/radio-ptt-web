<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PIN & IFSC Finder | Public Utility</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{--blue:#0b5ed7;--text:#e5e7eb}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  color:var(--text);
  background:
    radial-gradient(circle at top,#0b5ed7,#020617 65%);
  min-height:100vh;
}

/* HEADER */
header{
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(2,6,23,.65);
  backdrop-filter: blur(16px);
  border-bottom:1px solid rgba(255,255,255,.15);
  padding:16px;
}
header h2{margin:0}
header p{margin:4px 0 0;font-size:13px;opacity:.8}

/* LAYOUT */
.container{
  max-width:1100px;
  margin:auto;
  padding:16px;
}
.card{
  background:rgba(255,255,255,.08);
  backdrop-filter: blur(18px);
  border-radius:18px;
  padding:18px;
  margin-bottom:18px;
  border:1px solid rgba(255,255,255,.18);
  box-shadow:0 25px 45px rgba(0,0,0,.55);
}

/* CONTROLS */
button,input{
  padding:10px 14px;
  margin:6px 4px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,.25);
  background:rgba(255,255,255,.12);
  color:#fff;
}
button{
  background:linear-gradient(145deg,#0b5ed7,#084298);
  cursor:pointer;
}
input::placeholder{color:rgba(255,255,255,.6)}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
th,td{
  padding:10px;
  border-bottom:1px solid rgba(255,255,255,.15);
}
th{background:rgba(255,255,255,.18)}
td{background:rgba(255,255,255,.08)}

/* MAP */
.map-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
#mapWrapper{
  max-height:0;
  opacity:0;
  overflow:hidden;
  transition:.45s ease;
}
#mapWrapper.expanded{
  max-height:420px;
  opacity:1;
}
#map{
  height:300px;
  margin-top:14px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.2);
}

/* ERROR */
#globalError{
  display:none;
  background:rgba(185,28,28,.75);
  padding:10px;
  text-align:center;
  border-radius:10px;
  margin:12px;
}

/* FOOTER */
footer{
  text-align:center;
  font-size:12px;
  opacity:.6;
  padding:14px;
}
</style>
</head>

<body>

<div id="globalError">‚ö†Ô∏è Error</div>

<header>
  <h2>üìÆ India Post PIN & IFSC Finder</h2>
  <p>Location-based public utility</p>
</header>

<div class="container">

<!-- LOCATION -->
<div class="card">
  <h3>üìç Your Location</h3>
  <button onclick="detectLocation()">Use My Location</button>
  <button onclick="drawRadius(5); autoOpenMap()">5 km</button>
  <button onclick="drawRadius(10); autoOpenMap()">10 km</button>
  <div id="locInfo"></div>
</div>

<!-- BANK / ATM -->
<div class="card">
  <h3>üè¶ / üèß Banks & ATMs</h3>
  <label><input type="checkbox" id="showBanks" checked> Banks</label>
  <label><input type="checkbox" id="showATMs" checked> ATMs</label>
  <div id="bankList">No data</div>
</div>

<!-- PIN -->
<div class="card">
  <h3>üìÆ PIN Code</h3>
  <input id="pinInput" placeholder="6-digit PIN">
  <button onclick="findPIN()">Search</button>
  <div id="pinResult"></div>
</div>

<!-- IFSC -->
<div class="card">
  <h3>üè¶ IFSC Code</h3>
  <input id="ifscInput" placeholder="IFSC">
  <button onclick="findIFSC()">Search</button>
  <div id="ifscResult"></div>
</div>

<!-- MAP -->
<div class="card">
  <div class="map-header">
    <h3>üó∫ Nearby Places Map</h3>
    <button onclick="toggleMap()" id="mapBtn">Show Map ‚¨áÔ∏è</button>
  </div>
  <div id="mapWrapper">
    <div id="map"></div>
  </div>
</div>

</div>

<footer>
  Designed & Developed by <strong>Rankaj Kumar</strong>
</footer>

<script>
/* ERROR */
const err=document.getElementById("globalError");
function showError(m){err.innerText="‚ö†Ô∏è "+m;err.style.display="block"}
function clearError(){err.style.display="none"}

/* MAP */
const map=L.map("map").setView([22.97,78.65],5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

let userLat,userLon,userMarker,radiusCircle,markers=[];

/* MAP TOGGLE */
function toggleMap(){
  const w=document.getElementById("mapWrapper");
  const b=document.getElementById("mapBtn");
  if(w.classList.contains("expanded")){
    w.classList.remove("expanded");
    b.innerText="Show Map ‚¨áÔ∏è";
  }else{
    w.classList.add("expanded");
    b.innerText="Hide Map ‚¨ÜÔ∏è";
    setTimeout(()=>map.invalidateSize(),300);
  }
}
function autoOpenMap(){
  const w=document.getElementById("mapWrapper");
  if(!w.classList.contains("expanded")) toggleMap();
}

/* LOCATION */
function detectLocation(){
  clearError();
  navigator.geolocation.getCurrentPosition(p=>{
    userLat=p.coords.latitude;
    userLon=p.coords.longitude;
    if(userMarker) map.removeLayer(userMarker);
    userMarker=L.marker([userLat,userLon]).addTo(map)
      .bindPopup("Your Location").openPopup();
    map.setView([userLat,userLon],12);
    locInfo.innerText=`Lat ${userLat.toFixed(4)}, Lon ${userLon.toFixed(4)}`;
  },()=>showError("Location permission denied"),
  {enableHighAccuracy:true});
}

/* DISTANCE */
function distanceKm(a,b,c,d){
  const R=6371;
  const dLat=(c-a)*Math.PI/180;
  const dLon=(d-b)*Math.PI/180;
  const x=Math.sin(dLat/2)**2+
    Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*
    Math.sin(dLon/2)**2;
  return (R*2*Math.atan2(Math.sqrt(x),Math.sqrt(1-x))).toFixed(2);
}

/* RADIUS + BANKS */
async function drawRadius(km){
  if(!userLat){showError("Detect location first");return}
  if(radiusCircle) map.removeLayer(radiusCircle);
  radiusCircle=L.circle([userLat,userLon],{
    radius:km*1000,color:"#0b5ed7",fillOpacity:.15
  }).addTo(map);
  map.fitBounds(radiusCircle.getBounds());
  findNearbyPlaces(km);
}

async function findNearbyPlaces(km){
  bankList.innerText="Searching nearby‚Ä¶";
  markers.forEach(m=>map.removeLayer(m)); markers=[];
  const r=km*1000;
  const q=`[out:json];(
    node["amenity"="bank"](around:${r},${userLat},${userLon});
    node["amenity"="atm"](around:${r},${userLat},${userLon});
  );out;`;
  try{
    const res=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:q});
    const d=await res.json();
    if(!d.elements.length){bankList.innerText="No nearby places";return}
    let html="<table><tr><th>Name</th><th>Distance (km)</th></tr>";
    d.elements.slice(0,20).forEach(e=>{
      const dist=distanceKm(userLat,userLon,e.lat,e.lon);
      markers.push(L.marker([e.lat,e.lon]).addTo(map));
      html+=`<tr><td>${e.tags.name||"Bank / ATM"}</td><td>${dist}</td></tr>`;
    });
    bankList.innerHTML=html+"</table>";
  }catch{showError("Nearby service unavailable")}
}

/* PIN */
async function findPIN(){
  clearError(); pinResult.innerHTML="";
  const pin=pinInput.value.trim();
  if(pin.length!==6){showError("Invalid PIN");return}
  try{
    const r=await fetch(`https://api.postalpincode.in/pincode/${pin}`);
    const d=await r.json();
    const p=d[0].PostOffice[0];
    pinResult.innerHTML=`<table>
      <tr><th>Office</th><td>${p.Name}</td></tr>
      <tr><th>District</th><td>${p.District}</td></tr>
      <tr><th>State</th><td>${p.State}</td></tr>
    </table>`;
  }catch{showError("PIN not found")}
}

/* IFSC */
async function findIFSC(){
  clearError(); ifscResult.innerHTML="";
  const c=ifscInput.value.trim().toUpperCase();
  if(c.length<8){showError("Invalid IFSC");return}
  try{
    const r=await fetch(`https://ifsc.razorpay.com/${c}`);
    const d=await r.json();
    ifscResult.innerHTML=`<table>
      <tr><th>Bank</th><td>${d.BANK}</td></tr>
      <tr><th>Branch</th><td>${d.BRANCH}</td></tr>
      <tr><th>State</th><td>${d.STATE}</td></tr>
    </table>`;
  }catch{showError("IFSC not found")}
}
</script>
<script>
/* Disable right click */
document.addEventListener("contextmenu", function(e){
  e.preventDefault();
});

/* Optional: block common inspect shortcuts */
document.addEventListener("keydown", function(e){
  if(
    e.key === "F12" ||
    (e.ctrlKey && e.shiftKey && ["I","C","J"].includes(e.key)) ||
    (e.ctrlKey && e.key === "U")
  ){
    e.preventDefault();
  }
});
</script>
</body>
</html>
