<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>PIN & IFSC Finder | Govt Style</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Leaflet Map -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --bg:#eef3f9; --card:#fff; --text:#1f2937; --blue:#0b5ed7;
}
body{
  margin:0; font-family:Segoe UI,Arial;
  background:linear-gradient(135deg,#e8eef7,#f7faff);
  color:var(--text);
}
header{
  background:linear-gradient(90deg,#0b3c6d,#0b5ed7);
  color:#fff; padding:18px;
}
.container{max-width:1200px;margin:auto;padding:16px}
.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
}
input,button{
  padding:10px 12px;margin:4px;
  border-radius:10px;border:1px solid #d1d5db;
}
button{
  background:#0b5ed7;color:#fff;border:none;cursor:pointer;
}
#globalError{
  display:none;background:#b91c1c;color:#fff;
  padding:10px;text-align:center;
}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{padding:8px;border-bottom:1px solid #e5e7eb}
th{background:#f1f5f9}
#map{height:300px;border-radius:12px}
footer{
  background:#f8fafc;border-top:2px solid #0b5ed7;
  padding:14px;text-align:center;font-size:12px;
}
</style>
</head>

<body>

<div id="globalError">‚ö†Ô∏è Error</div>

<header>
  <h2>India Post PIN & IFSC Finder</h2>
  <p>Location-aware Public Utility</p>
</header>

<div class="container">

<!-- LOCATION -->
<div class="card">
  <h3>üìç Your Location</h3>
  <button onclick="detectLocation()">Use My Location</button>
  <button onclick="drawRadius(5)">5 km Radius</button>
  <button onclick="drawRadius(10)">10 km Radius</button>
  <button onclick="findNearestPIN()">Nearest PIN</button>
  <button onclick="nearestBank()">Nearest Bank (City)</button>
  <div id="locInfo"></div>
</div>

<!-- MAP -->
<div class="card">
  <h3>üó∫ Map</h3>
  <div id="map"></div>
</div>

<!-- PIN SEARCH -->
<div class="card">
  <h3>üìÆ PIN Code Details</h3>
  <input id="pinInput" placeholder="6-digit PIN">
  <button onclick="findPIN()">Search PIN</button>
  <div id="pinResult"></div>
</div>

<!-- IFSC SEARCH -->
<div class="card">
  <h3>üè¶ IFSC Code Details</h3>
  <input id="ifscInput" placeholder="IFSC Code">
  <button onclick="findIFSC()">Search IFSC</button>
  <div id="ifscResult"></div>
</div>

</div>

<footer>
  <div>Data Source: India Post (Public) & RBI IFSC (Public)</div>
  <div>Designed & Developed by <strong>Rankaj Kumar</strong></div>
</footer>

<script>
/* ===== ERROR ===== */
function showError(msg){
  globalError.innerText="‚ö†Ô∏è "+msg;
  globalError.style.display="block";
}
function clearError(){ globalError.style.display="none"; }

/* ===== MAP INIT ===== */
const map = L.map('map').setView([22.97,78.65],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let marker=null, radiusCircle=null;
let userLat=null, userLon=null;

/* ===== LOCATION ===== */
function detectLocation(){
  clearError();
  if(!navigator.geolocation){
    showError("Geolocation not supported");
    return;
  }
  navigator.geolocation.getCurrentPosition(
    pos=>{
      userLat=pos.coords.latitude;
      userLon=pos.coords.longitude;
      updateMap(userLat,userLon,"Your Location");
      locInfo.innerText =
        `Latitude: ${userLat.toFixed(4)}, Longitude: ${userLon.toFixed(4)}`;
    },
    err=>{
      showError("Location permission denied or unavailable");
    },
    {enableHighAccuracy:true,timeout:10000}
  );
}

/* ===== MAP HELPERS ===== */
function updateMap(lat,lon,label){
  if(marker) map.removeLayer(marker);
  marker=L.marker([lat,lon]).addTo(map).bindPopup(label).openPopup();
  map.setView([lat,lon],12);
}
function drawRadius(km){
  if(!userLat||!userLon){
    showError("Detect location first");
    return;
  }
  if(radiusCircle) map.removeLayer(radiusCircle);
  radiusCircle=L.circle([userLat,userLon],{
    radius:km*1000,
    color:"#0b5ed7",
    fillOpacity:0.15
  }).addTo(map);
  map.fitBounds(radiusCircle.getBounds());
}

/* ===== DISTANCE ===== */
function getDistanceKm(lat1,lon1,lat2,lon2){
  const R=6371;
  const dLat=(lat2-lat1)*Math.PI/180;
  const dLon=(lon2-lon1)*Math.PI/180;
  const a=Math.sin(dLat/2)**2+
    Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
    Math.sin(dLon/2)**2;
  return (R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))).toFixed(2);
}

/* ===== NEAREST PIN (APPROX) ===== */
async function findNearestPIN(){
  if(!userLat||!userLon){
    showError("Detect location first");
    return;
  }
  try{
    const r=await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLat}&lon=${userLon}`,
      {headers:{'User-Agent':'GovtStyleApp'}}
    );
    const d=await r.json();
    alert(`üìÆ Nearest PIN (approx): ${d.address.postcode || "Not available"}`);
  }catch{
    showError("Unable to find nearest PIN");
  }
}

/* ===== NEAREST BANK (CITY LEVEL) ===== */
async function nearestBank(){
  if(!userLat||!userLon){
    showError("Detect location first");
    return;
  }
  try{
    const r=await fetch(
      `https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLat}&lon=${userLon}`,
      {headers:{'User-Agent':'GovtStyleApp'}}
    );
    const d=await r.json();
    const city=d.address.city||d.address.town||d.address.village||"";
    alert(`üè¶ Nearest bank search area:\nCity: ${city}\nUse IFSC search for branches`);
  }catch{
    showError("Unable to detect bank area");
  }
}

/* ===== PIN SEARCH ===== */
async function findPIN(){
  clearError(); pinResult.innerHTML="";
  const pin=pinInput.value.trim();
  if(pin.length!==6){ showError("Enter valid PIN"); return; }
  try{
    const r=await fetch(`https://api.postalpincode.in/pincode/${pin}`);
    const d=await r.json();
    if(d[0].Status!=="Success") throw "";
    const p=d[0].PostOffice[0];
    pinResult.innerHTML=`
    <table>
      <tr><th>Post Office</th><td>${p.Name}</td></tr>
      <tr><th>District</th><td>${p.District}</td></tr>
      <tr><th>State</th><td>${p.State}</td></tr>
    </table>`;
  }catch{
    showError("PIN not found");
  }
}

/* ===== IFSC SEARCH ===== */
async function findIFSC(){
  clearError(); ifscResult.innerHTML="";
  const i=ifscInput.value.trim().toUpperCase();
  if(i.length<8){ showError("Invalid IFSC"); return; }
  try{
    const r=await fetch(`https://ifsc.razorpay.com/${i}`);
    if(!r.ok) throw "";
    const d=await r.json();
    ifscResult.innerHTML=`
    <table>
      <tr><th>Bank</th><td>${d.BANK}</td></tr>
      <tr><th>Branch</th><td>${d.BRANCH}</td></tr>
      <tr><th>City</th><td>${d.CITY}</td></tr>
      <tr><th>State</th><td>${d.STATE}</td></tr>
    </table>`;
  }catch{
    showError("IFSC not found");
  }
}
</script>

</body>
</html>
